<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Novacortex Project Budget Tracker</title>
  <style>
    body { font-family: Arial; background: #e9f0f7; padding: 20px; }
    .container { max-width: 900px; margin: auto; }
    .btn { padding: 10px 18px; border: none; border-radius: 5px; background: #3498db; color: #fff; cursor: pointer; }
    .btn:hover { background: #217dbb; }
    .modal { display: none; position: fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); justify-content:center; align-items:center; }
    .modal-content { background: #fff; padding: 30px; border-radius: 10px; min-width: 350px; }
    .form-group { margin-bottom: 12px; }
    label { display: block; font-weight: 600; margin-bottom: 4px; }
    input, select, textarea { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
    table { border-collapse: collapse; width: 100%; margin-top: 25px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #3498db; color: #fff; }
    tr:nth-child(even) { background: #f4f7fb; }
    .close-btn { background: #e74c3c; margin-left: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Novacortex Project Budget Tracker</h1>
    <button class="btn" onclick="showModal()">+ Add Task</button>
    <div id="modal" class="modal">
      <div class="modal-content">
        <h2>Add New Task</h2>
        <form id="task-form">
          <div class="form-group">
            <label>Task Name</label>
            <input type="text" id="task" required />
          </div>
          <div class="form-group">
            <label>Status</label>
            <select id="status">
              <option>Open</option>
              <option>In Progress</option>
              <option>Complete</option>
            </select>
          </div>
          <div class="form-group">
            <label>Hours Spent</label>
            <input type="number" id="hours" min="0" required />
          </div>
          <div class="form-group">
            <label>Billing Status</label>
            <select id="billing">
              <option>Billable</option>
              <option>Relationship Building</option>
            </select>
          </div>
          <div class="form-group">
            <label>Notes/Description</label>
            <textarea id="notes"></textarea>
          </div>
          <div class="form-group">
            <label>Updates/Comments</label>
            <input type="text" id="comment" />
          </div>
          <div class="form-group">
            <label>Your Name</label>
            <input type="text" id="created_by" required />
          </div>
          <button type="submit" class="btn">Submit</button>
          <button type="button" class="btn close-btn" onclick="hideModal()">Cancel</button>
        </form>
        <div id="form-msg" style="margin-top:10px;color:#e74c3c;"></div>
      </div>
    </div>
    <table id="task-table">
      <thead>
        <tr>
          <th>Task Name</th><th>Status</th><th>Hours Spent</th><th>Billing Status</th>
          <th>Notes/Description</th><th>Updates/Comments</th><th>Created By</th><th>Created On</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <script>
    // CHANGE THIS TO YOUR APPS SCRIPT WEB APP URL!
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzSk_YiMXL1zIBtOh1ndQxxjdWi0mi-JiHs-hbsXaRixvTL1d_QxHynEg2Fc4pCJa1y/exec';

    function showModal() {
      document.getElementById('modal').style.display = 'flex';
      document.getElementById('form-msg').textContent = '';
    }
    function hideModal() {
      document.getElementById('modal').style.display = 'none';
      document.getElementById('task-form').reset();
    }

    document.getElementById('task-form').onsubmit = async function(e) {
      e.preventDefault();
      const data = {
        task: document.getElementById('task').value,
        status: document.getElementById('status').value,
        hours: document.getElementById('hours').value,
        billing: document.getElementById('billing').value,
        notes: document.getElementById('notes').value,
        comment: document.getElementById('comment').value,
        created_by: document.getElementById('created_by').value
      };
      try {
        const resp = await fetch(APPS_SCRIPT_URL, {
          method: "POST",
          body: JSON.stringify(data),
          headers: {'Content-Type': 'application/json'}
        });
        const result = await resp.json();
        if (result.result === "success") {
          hideModal();
          loadTasks();
        } else {
          document.getElementById('form-msg').textContent = "Error: " + (result.error || "Could not add task");
        }
      } catch {
        document.getElementById('form-msg').textContent = "Network error, please try again.";
      }
    };

    async function loadTasks() {
      try {
        const resp = await fetch(APPS_SCRIPT_URL);
        const rows = await resp.json();
        const tbody = document.querySelector('#task-table tbody');
        tbody.innerHTML = "";
        rows.slice(1).forEach(row => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const td = document.createElement('td');
            td.innerHTML = cell;
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
      } catch {
        document.querySelector('#task-table tbody').innerHTML =
          '<tr><td colspan="8" style="color:red">Failed to load tasks. Please check connection.</td></tr>';
      }
    }
    loadTasks();
    // Optionally, auto-refresh every minute:
    setInterval(loadTasks, 60000);
  </script>
</body>
</html>
